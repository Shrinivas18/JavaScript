<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Main Stock Market Analysis</title>
  </head>
  <style>
   * {
  box-sizing: border-box;
  font-family: Arial, Helvetica, sans-serif;
}

body {
  margin: 0;
  background: radial-gradient(circle at top, #050533, #010116);
  color: white;
}

#main {
  min-height: 100vh;
  padding: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 20px;
  font-size: 2rem;
  letter-spacing: 1px;
}

#firstLayer {
  display: flex;
  gap: 20px;
  justify-content: center;
}

#graph {
  height: 78vh;
  width: 70vw;
  background: linear-gradient(180deg, #05094f, #020230);
  border-radius: 15px;
  padding: 20px;
  box-shadow: 0 0 30px rgba(0, 0, 0, 0.6);
}

#stocksBlock {
  height: 78vh;
  width: 24vw;
  background: linear-gradient(180deg, #05094f, #020230);
  border-radius: 15px;
  padding: 15px;
  box-shadow: 0 0 30px rgba(0, 0, 0, 0.6);
  overflow-y: auto;
}

#stocks {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  row-gap: 15px;
  column-gap:1px;
  align-items: center;
  text-align: left;
}

span{
  font-weight: lighter;
}

.btnClass {
  background-color: #070b7a;
  color: white;
  border-top: 3px solid rgba(255, 255, 255, 0.2);
  border-left: 3px solid rgba(255, 255, 255, 0.2);
  border-radius: 6px;
  padding: 4px 10px;
  font-size: 0.75rem;
  font-size:.8rem;
  width: 4rem;
  cursor: pointer;
}

.btnClass:hover {
  background-color: #0a10b5;
}

.profit {
  color: #00ff6a;
  font-weight: bold;
}

.noProfit {
  color: #ff3b3b;
  font-weight: bold;
}

#description {
  width: 70vw;
  border-radius: 15px;
  padding: 20px;
  font-size: 0.9rem;
  line-height: 1.6;
}

  </style>
  <body>
    <div id="main">
      <h1>Stock Market Analysis</h1>
      <div id="firstLayer">
        <div id="graph"></div>
        <div id="stocksBlock"><div id="stocks"></div></div>
      </div>
      <div id="description">
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Voluptas
          possimus eaque suscipit aliquid, dolor alias assumenda vero quasi
          praesentium, laudantium vel ipsum, ea hic tempora qui? Esse
          necessitatibus rerum fuga. Lorem ipsum dolor sit amet consectetur,
          adipisicing elit. Facilis a libero suscipit dolorem consequuntur
          placeat molestiae blanditiis voluptatibus totam unde odio cum
          architecto tenetur eligendi reiciendis, commodi nobis itaque ea?
        </p>
      </div>
    </div>
  </body>
</html>

<script>
  const stocksDataURL =
    "https://stock-market-api-k9vl.onrender.com/api/stocksdata";
  const bookValueAndProfitURL =
    "https://stock-market-api-k9vl.onrender.com/api/stocksstatsdata";
  const stockSummaryURL =
    "https://stock-market-api-k9vl.onrender.com/api/profiledata";

  const graphDiv = document.getElementById("graph");
  const descDiv = document.getElementById("description");

  let stocksData;
  let stockNames;
  let summaryData;
  const oneMonth = "1mo";
  const threeMonths = "3mo";
  const oneYear = "1y";
  const fiveYears = "5y";

  async function getAllStocksData() {
    try {
      const resp = await fetch(stocksDataURL);
      const data = await resp.json();
      return data.stocksData;
    } catch (e) {
      console.log("Something went wrong: ", e);
    }
  }

  function getStockDataForOneMonth(selectedStock) {
    return stocksData[0][selectedStock][oneMonth];
  }

  function getStockDataForThreeMonths(selectedStock) {
    return stocksData[0][selectedStock][threeMonths];
  }

  function getStockDataForOneYear(selectedStock) {
    return stocksData[0][selectedStock][oneYear];
  }

  function getStockDataForFiveYears(selectedStock) {
    return stocksData[0][selectedStock][fiveYears];
  }

  async function bookedValueAndProfit(){
    const resp = await fetch(bookValueAndProfitURL)
    const data = await resp.json();
    return data.stocksStatsData[0];
  }

  async function getSummaryData(){
    let resp = await fetch(stockSummaryURL);
    let data = await resp.json();
    return data.stocksProfileData;
  }

  function onClickStockButton(stockName) {
    let description = stocksData[stockName];
  }

  function generateStockButton(stockName, bookValAndProfitResponse) {
    const stocksDiv = document.getElementById("stocks");
    const newButton = document.createElement("button");
    newButton.textContent = stockName;
    newButton.type = "button";
    newButton.className = "btnClass";
    newButton.addEventListener("click", () => onClickStockButton(stockName));

    const bookVal = document.createElement('span');
    const profitVal = document.createElement('span');
    
    if(bookValAndProfitResponse.profit > 0) profitVal.classList.add('profit')
    else profitVal.classList.add('noProfit')
    
    bookVal.innerHTML = '$'+ bookValAndProfitResponse.bookValue.toFixed(3);
    profitVal.innerHTML = bookValAndProfitResponse.profit.toFixed(2) + '%';

    stocksDiv.appendChild(newButton);
    stocksDiv.appendChild(bookVal);
    stocksDiv.appendChild(profitVal);

    stocksBlock = document.getElementById("stocksBlock");
    stocksBlock.appendChild(stocksDiv)
  }

  async function main() {
    stocksData = await getAllStocksData();
    stockNames = Object.keys(stocksData[0]).slice(1);
    bookValAndProfit = await bookedValueAndProfit();
    summaryData = await getSummaryData();

    for (let i = 0; i < stockNames.length; i++) {
      generateStockButton(stockNames[i], bookValAndProfit[stockNames[i]]);
    }
  }

  main();
</script>
